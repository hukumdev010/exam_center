version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo 'Starting preBuild phase...'
        - echo 'Current working directory:'
        - pwd
        - echo 'Contents of current directory:'
        - ls -la
        - echo 'Checking if frontend directory exists:'
        - ls -la frontend/ || echo 'Frontend directory not found - assuming we are in frontend directory'
        - |
          if [ -d "frontend" ]; then
            echo 'Found frontend directory, changing to it...'
            cd frontend
            echo 'Installing dependencies in frontend directory...'
            npm ci
          else
            echo 'No frontend subdirectory found, assuming current directory is frontend'
            echo 'Installing dependencies in current directory...'
            npm ci
          fi
        - echo 'Dependencies installed successfully'
    build:
      commands:
        - echo 'Starting build phase...'
        - |
          if [ -d "frontend" ]; then
            echo 'Building from frontend subdirectory...'
            cd frontend
            npm run build
          else
            echo 'Building from current directory...'
            npm run build
          fi
        - echo 'Build completed successfully'
  artifacts:
    baseDirectory: .next
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
